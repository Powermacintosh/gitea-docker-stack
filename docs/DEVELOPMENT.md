# Custom Gitea

Руководство по разработке и тестированию кастомного Gitea.

## Установка frontend зависимостей

```sh
# Установка зависимостей
pnpm install

# Проверяет, что хеши в pnpm-lock.yaml совпадают с установленными пакетами
pnpm install --frozen-lockfile --verify-store-integrity

# Проверяет наличие уязвимостей в зависимостях
pnpm audit
```

## Разработка

```sh
# Запуск фронтенда и бэкенда для разработки
make watch

# Запуск фронтенда с автоматической пересборкой
make watch-frontend

# Запуск бэкенда с автоматической пересборкой
make watch-backend
```

### Запуск линтеров

```sh
make build              # сборка, перед запуском линтеров не обязательно
make lint-frontend      # линтеры для фронтенда
make lint-frontend-fix  # исправление линтеров для фронтенда

make fmt                # форматирование кода и импортов
make lint-backend       # линтеры для бэкенда
make lint-backend-fix   # исправление линтеров для бэкенда
```

## Сборка кастомного docker-образа

- Эту команду нужно запускать из директории исходников репозитория gitea.

```sh
docker build -t custom-gitea:1.25.1 -f Dockerfile .
```

- -t custom-gitea:1.25.1 - имя и тег образа
- -f Dockerfile - указываем использовать локальный Dockerfile
- . - контекст сборки (текущая директория)

### Запуск контейнера

#### Запуск контейнера docker

- Запускать собранный контейнер можно из любой директории этой командой:

```sh
docker run -d --name=gitea -p 3000:3000 -p 2222:22 -v gitea_data:/data custom-gitea:1.22.1
```

- -d - запуск в фоновом режиме
- --name=gitea - имя контейнера
- -p 3000:3000 -p 2222:22 -v gitea_data:/data - порты и монтирование директории
- custom-gitea:1.22.1 - имя образа

#### Запуск через docker-compose

```sh
docker-compose up --build -d   # сборка и запуск в фоновом режиме
docker-compose down            # остановка контейнеров
docker-compose up -d           # запуск в фоновом режиме
```

### Документация

Хорошие имена репозиториев используют короткие, запоминающиеся и уникальные ключевые слова. Репозиторий с именем ".profile" или ".profile-private" можно использовать для добавления README.md в профиль пользователя/организации.

.profile — это специальный репозиторий, который можно использовать для добавления README.md в публичный профиль организации, видимый всем. Убедитесь, что он публичный, и инициализируйте его с README в директории профиля, чтобы начать.

.profile-private — это специальный репозиторий, который можно использовать для добавления README.md в профиль участника организации, видимый только участникам организации. Убедитесь, что он приватный, и инициализируйте его с README в директории профиля, чтобы начать.

# Что такое Git LFS (Large File Storage)

- Требуется для тестирования

Git LFS (Large File Storage) — расширение для Git, которое хранит большие файлы (бинарники, медиа) вне репозитория, оставляя в Git только ссылки-указатели. Сами файлы лежат в отдельном хранилище и скачиваются по требованию.

## Зачем нужно для тестов Gitea

В репозиториях тестовых данных используются LFS-объекты. Цель git-check в Makefile проверяет наличие git lfs, без него интеграционные тесты не запустятся: см. Makefile
git-check (строки около 222-227): проверка git lfs в PATH.

```sh
brew install git-lfs
git lfs install
git lfs version
```
